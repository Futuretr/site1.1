{% extends "base.html" %}

{% block content %}
<!-- Premium Kontrol -->
{% if not current_user.is_authenticated %}
    <!-- Hero Section -->
    <div class="hero-section position-relative overflow-hidden" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 80vh;">
        <div class="container py-5">
            <div class="row align-items-center min-vh-75">
                <div class="col-lg-6">
                    <div class="hero-content text-white">
                        <h1 class="display-4 fw-bold mb-4 animate-fade-in">
                            ğŸ† TÃ¼rkiye'nin En GeliÅŸmiÅŸ<br>
                            <span class="text-warning">At YarÄ±ÅŸÄ± Analiz Sistemi</span>
                        </h1>
                        <p class="lead mb-4 animate-fade-in-delay">
                            Yapay zeka destekli algoritmalarÄ±mÄ±zla 9 farklÄ± ÅŸehirden canlÄ± veri Ã§ekerek 
                            <strong class="text-warning">profesyonel</strong> at yarÄ±ÅŸÄ± analizleri yapÄ±n!
                        </p>
                        <div class="hero-stats row mb-4 g-3">
                            <div class="col-md-4 col-12 text-center stat-item" data-tooltip="Son 6 ayda analiz edilen toplam koÅŸu sayÄ±sÄ±">
                                <h3 class="text-warning fw-bold counter mb-1" data-target="1500">0+</h3>
                                <small class="d-block text-white-50">Analiz Edilen KoÅŸu</small>
                            </div>
                            <div class="col-md-4 col-12 text-center stat-item" data-tooltip="Sistem baÅŸarÄ± oranÄ±mÄ±z">
                                <h3 class="text-warning fw-bold counter mb-1" data-target="77">0%</h3>
                                <small class="d-block text-white-50">BaÅŸarÄ± OranÄ±</small>
                            </div>
                            <div class="col-md-4 col-12 text-center stat-item" data-tooltip="Aktif kullanÄ±cÄ± sayÄ±sÄ±">
                                <h3 class="text-warning fw-bold counter mb-1" data-target="2800">0+</h3>
                                <small class="d-block text-white-50">Aktif KullanÄ±cÄ±</small>
                            </div>
                        </div>
                        <div class="hero-buttons mb-4">
                            <a href="{{ url_for('auth.register') }}" class="btn btn-warning btn-lg me-3 animate-button">
                                <i class="fas fa-rocket"></i> Ãœcretsiz BaÅŸlayÄ±n
                            </a>
                            <a href="#ozellikler" class="btn btn-outline-light btn-lg animate-button">
                                <i class="fas fa-info-circle"></i> Ã–zellikleri GÃ¶rÃ¼n
                            </a>
                        </div>
                        <div class="hero-badges">
                            <span class="badge bg-success me-2"><i class="fas fa-check"></i> 100% Ãœcretsiz Deneme</span>
                            <span class="badge bg-info me-2"><i class="fas fa-shield-alt"></i> GÃ¼venli Platform</span>
                            <span class="badge bg-warning text-dark"><i class="fas fa-trophy"></i> #1 Analiz Sistemi</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="text-center">
                        <img src="https://images.unsplash.com/photo-1553284965-83fd3e82fa5a?ixlib=rb-4.0.3&w=600&h=400&fit=crop" 
                             alt="At YarÄ±ÅŸÄ± - Grup KoÅŸu" class="img-fluid rounded shadow-lg mb-4" style="max-height: 300px; object-fit: cover;">
                        <div class="mt-3">
                            <h4 class="text-white mb-3">ğŸ“Š Profesyonel Analiz Sistemi</h4>
                            <p class="text-white-50">GeliÅŸmiÅŸ algoritmalarÄ±mÄ±zla at yarÄ±ÅŸÄ± verilerini analiz edin ve baÅŸarÄ±lÄ± tahminler yapÄ±n!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ã–zellikler Section -->
    <section id="ozellikler" class="py-5 bg-light">
        <div class="container">
            <div class="row mb-5">
                <div class="col-12 text-center">
                    <h2 class="display-5 fw-bold mb-3">ğŸš€ Neden Bu Kadar PopÃ¼ler?</h2>
                    <p class="lead text-muted">TÃ¼rkiye'nin en kapsamlÄ± at yarÄ±ÅŸÄ± analiz sistemi</p>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="feature-card card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="feature-icon mb-3">
                                <i class="fas fa-brain fa-3x text-primary"></i>
                            </div>
                            <h5 class="fw-bold">Yapay Zeka AlgoritmasÄ±</h5>
                            <p class="text-muted">GeliÅŸmiÅŸ makine Ã¶ÄŸrenmesi ile %77.3 baÅŸarÄ± oranÄ±na ulaÅŸtÄ±k.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="feature-icon mb-3">
                                <i class="fas fa-map-marked-alt fa-3x text-success"></i>
                            </div>
                            <h5 class="fw-bold">9 Åehir KapsamÄ±</h5>
                            <p class="text-muted">Ä°stanbul, Ankara, Ä°zmir ve 6 ÅŸehir daha! TÃ¼rkiye'nin en kapsamlÄ± aÄŸÄ±.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="feature-icon mb-3">
                                <i class="fas fa-clock fa-3x text-warning"></i>
                            </div>
                            <h5 class="fw-bold">GerÃ§ek ZamanlÄ±</h5>
                            <p class="text-muted">CanlÄ± veri akÄ±ÅŸÄ± ile anlÄ±k gÃ¼ncellemeler ve hÄ±zlÄ± analizler.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- BaÅŸarÄ± Ä°statistikleri -->
    <section class="py-5 bg-primary text-white">
        <div class="container">
            <div class="row text-center">
                <div class="col-md-3 mb-4">
                    <h3 class="display-4 fw-bold counter" data-target="9">0</h3>
                    <p class="lead">Åehir KapsamÄ±</p>
                </div>
                <div class="col-md-3 mb-4">
                    <h3 class="display-4 fw-bold">%77.3</h3>
                    <p class="lead">BaÅŸarÄ± OranÄ±</p>
                </div>
                <div class="col-md-3 mb-4">
                    <h3 class="display-4 fw-bold counter" data-target="1500">0+</h3>
                    <p class="lead">Analiz Edilen KoÅŸu</p>
                </div>
                <div class="col-md-3 mb-4">
                    <h3 class="display-4 fw-bold counter" data-target="2800">0+</h3>
                    <p class="lead">Mutlu KullanÄ±cÄ±</p>
                </div>
            </div>
        </div>
    </section>

    <!-- KullanÄ±cÄ± YorumlarÄ± -->
    <section class="py-5">
        <div class="container">
            <div class="row mb-5">
                <div class="col-12 text-center">
                    <h2 class="display-5 fw-bold mb-3">ğŸ’¬ KullanÄ±cÄ±larÄ±mÄ±z Ne Diyor?</h2>
                    <p class="lead text-muted">Binlerce kullanÄ±cÄ±dan gelen gerÃ§ek yorumlar</p>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="testimonial-card card border-0 shadow-sm h-100">
                        <div class="card-body p-4">
                            <div class="stars mb-3 text-warning">
                                <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                            </div>
                            <p class="mb-3">"Profesyonel analiz sistemi! 9 ÅŸehirden veri Ã§ekebilmesi harika. GerÃ§ekten kapsamlÄ± bir platform."</p>
                            <div class="d-flex align-items-center">
                                <div>
                                    <h6 class="mb-0">Mehmet K.</h6>
                                    <small class="text-muted">Premium Ãœye - Ä°stanbul</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="testimonial-card card border-0 shadow-sm h-100">
                        <div class="card-body p-4">
                            <div class="stars mb-3 text-warning">
                                <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                            </div>
                            <p class="mb-3">"Profesyonel analiz sistemi! Excel Ã§Ä±ktÄ±larÄ± sayesinde kendi stratejilerimi de geliÅŸtirebiliyorum. Harika bir platform."</p>
                            <div class="d-flex align-items-center">
                                <div>
                                    <h6 class="mb-0">Mustafa Ã–.</h6>
                                    <small class="text-muted">Premium Ãœye - Ankara</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="testimonial-card card border-0 shadow-sm h-100">
                        <div class="card-body p-4">
                            <div class="stars mb-3 text-warning">
                                <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                            </div>
                            <p class="mb-3">"AI destekli analizler gerÃ§ekten iÅŸe yarÃ­yor! %80'e yakÄ±n baÅŸarÄ± oranÄ±m var artÄ±k."</p>
                            <div class="d-flex align-items-center">
                                <div>
                                    <h6 class="mb-0">Can Y.</h6>
                                    <small class="text-muted">Premium Ãœye - Ä°zmir</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="py-5 text-white" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
        <div class="container text-center">
            <h2 class="display-5 fw-bold mb-3">ğŸ¯ Hemen BaÅŸlayÄ±n!</h2>
            <p class="lead mb-4">Profesyonel analizlerle kazanÃ§larÄ±nÄ±zÄ± artÄ±rÄ±n</p>
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="d-grid gap-3 d-md-flex justify-content-md-center">
                        <a href="{{ url_for('auth.register') }}" class="btn btn-warning btn-lg px-5">
                            <i class="fas fa-rocket"></i> Ãœcretsiz KayÄ±t Ol
                        </a>
                        <a href="{{ url_for('auth.login') }}" class="btn btn-outline-light btn-lg px-5">
                            <i class="fas fa-sign-in-alt"></i> GiriÅŸ Yap
                        </a>
                    </div>
                    <div class="mt-3">
                        <small class="opacity-75">
                            <i class="fas fa-check"></i> Kredi kartÄ± gerekmez 
                            <i class="fas fa-check ms-3"></i> AnÄ±nda eriÅŸim
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </section>

{% else %}
    <!-- Authenticated User Dashboard -->
    <div class="container-fluid py-4">
        <!-- KullanÄ±cÄ± KarÅŸÄ±lama -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="card-body text-white">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h2 class="mb-1">HoÅŸ geldiniz, {{ current_user.first_name }}!</h2>
                                <p class="mb-0 lead">At yarÄ±ÅŸÄ± analiz sisteminize hoÅŸ geldiniz.</p>
                            </div>
                            <div class="col-md-4 text-end">
                                {% if current_user.is_premium %}
                                    <span class="badge bg-warning text-dark fs-6 p-2">
                                        <i class="fas fa-crown"></i> Premium Ãœye
                                    </span>
                                {% else %}
                                    <a href="{{ url_for('auth.premium') }}" class="btn btn-warning btn-lg">
                                        <i class="fas fa-crown"></i> Premium Ol
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ana Ä°Ã§erik -->
        <div class="row">
            <div class="col-lg-8">
                <!-- Analiz Paneli -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-chart-line"></i> At YarÄ±ÅŸÄ± Analiz Sistemi</h5>
                    </div>
                    <div class="card-body">
                        <!-- Åehir SeÃ§imi -->
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="citySelect" class="form-label fw-bold">Åehir SeÃ§in:</label>
                                <select class="form-select" id="citySelect" onchange="updateAnalysisInfo()">
                                    <option value="">Åehir seÃ§iniz...</option>
                                    <option value="istanbul">Ä°stanbul</option>
                                    <option value="ankara">Ankara</option>
                                    <option value="izmir">Ä°zmir</option>
                                    <option value="bursa">Bursa</option>
                                    <option value="adana">Adana</option>
                                    <option value="kocaeli">Kocaeli</option>
                                    <option value="sanliurfa">ÅanlÄ±urfa</option>
                                    <option value="diyarbakir">DiyarbakÄ±r</option>
                                    <option value="elazig">ElazÄ±ÄŸ</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Ä°ÅŸlem:</label>
                                <button class="btn btn-success w-100" id="analyzeBtn" onclick="startAnalysis()" disabled>
                                    <i class="fas fa-play"></i> Analizi BaÅŸlat
                                </button>
                            </div>
                        </div>

                        <!-- Durum GÃ¶stergeleri -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <div id="statusContainer" style="display: none;">
                                    <div class="alert alert-info">
                                        <div class="d-flex align-items-center">
                                            <div class="spinner-border spinner-border-sm me-3" role="status"></div>
                                            <div>
                                                <strong>Analiz devam ediyor...</strong>
                                                <div id="statusText" class="small">Veri Ã§ekiliyor...</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ã–zet Ä°statistikler -->
                        <div id="summaryStats" class="row mb-3 p-2" style="display: none;"></div>

                        <!-- KoÅŸu SonuÃ§larÄ± -->
                        <div id="results" class="race-results"></div>
                    </div>
                </div>

                <!-- KarÅŸÄ±laÅŸtÄ±rma SonuÃ§larÄ± -->
                <div id="comparisonContainer" style="display: none;">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0"><i class="fas fa-balance-scale"></i> Tahmin vs GerÃ§ek SonuÃ§lar</h5>
                        </div>
                        <div class="card-body">
                            <div id="comparisonResults"></div>
                        </div>
                    </div>
                </div>

                <!-- DÃ¼nkÃ¼ SonuÃ§lar -->
                <div id="yesterdayContainer" style="display: none;">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="fas fa-calendar-day"></i> DÃ¼nkÃ¼ KoÅŸu SonuÃ§larÄ±</h5>
                        </div>
                        <div class="card-body">
                            <div id="yesterdayResults"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Yan Panel -->
            <div class="col-lg-4">
                <!-- HÄ±zlÄ± Ä°statistikler -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-success text-white">
                        <h6 class="mb-0"><i class="fas fa-tachometer-alt"></i> HÄ±zlÄ± Ä°statistikler</h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6 mb-3">
                                <h4 class="text-primary mb-1">9</h4>
                                <small class="text-muted">Åehir</small>
                            </div>
                            <div class="col-6 mb-3">
                                <h4 class="text-success mb-1">%77.3</h4>
                                <small class="text-muted">BaÅŸarÄ± OranÄ±</small>
                            </div>
                            <div class="col-6">
                                <h4 class="text-warning mb-1" id="analysisCount">{{ current_user.daily_analysis_count or 0 }}</h4>
                                <small class="text-muted">GÃ¼nlÃ¼k Analiz</small>
                            </div>
                            <div class="col-6">
                                <h4 class="text-info mb-1">{{ current_user.total_predictions or 0 }}</h4>
                                <small class="text-muted">Toplam Tahmin</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Son Ä°ÅŸlemler -->
                <div class="card shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <h6 class="mb-0"><i class="fas fa-history"></i> Son Ä°ÅŸlemler</h6>
                    </div>
                    <div class="card-body">
                        <div id="recentAnalyses">
                            <p class="text-muted small">HenÃ¼z analiz yapÄ±lmamÄ±ÅŸ.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
// Premium kontrol iÃ§in JavaScript gÃ¼ncellemesi
document.addEventListener('DOMContentLoaded', function() {
    // URL'den analiz parametrelerini kontrol et
    const urlParams = new URLSearchParams(window.location.search);
    const analysisDone = urlParams.get('analysis_done');
    const city = urlParams.get('city');
    
    if (analysisDone === 'true' && city) {
        // Åehiri seÃ§ ve analizi gÃ¶ster
        const citySelect = document.getElementById('citySelect');
        if (citySelect) {
            citySelect.value = city;
            updateAnalysisInfo();
            loadSavedAnalysis();
        }
    }
    
    // Counter animasyonu
    animateCounters();
    
    // Smooth scroll
    smoothScroll();
});

// Åehir seÃ§imi gÃ¼ncelleme
function updateAnalysisInfo() {
    const citySelect = document.getElementById('citySelect');
    const analyzeBtn = document.getElementById('analyzeBtn');
    
    if (citySelect && analyzeBtn) {
        analyzeBtn.disabled = !citySelect.value;
    }
}

// Analiz baÅŸlatma
function startAnalysis() {
    const citySelect = document.getElementById('citySelect');
    const selectedCity = citySelect.value;
    
    if (!selectedCity) {
        alert('LÃ¼tfen bir ÅŸehir seÃ§in!');
        return;
    }
    
    // Premium kontrolÃ¼
    if (!window.isPremium && window.dailyAnalysisCount >= 3) {
        if (confirm('GÃ¼nlÃ¼k Ã¼cretsiz analiz hakkÄ±nÄ±z doldu. Premium Ã¼yelik satÄ±n almak ister misiniz?')) {
            window.location.href = '/auth/premium';
            return;
        } else {
            return;
        }
    }
    
    // Analiz baÅŸlat
    showStatus('Analiz baÅŸlatÄ±lÄ±yor...');
    
    fetch('/api/scrape_city', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            city: selectedCity
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showResults(data);
            updateAnalysisCount();
        } else {
            showError(data.error || 'Analiz sÄ±rasÄ±nda bir hata oluÅŸtu.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showError('Bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');
    })
    .finally(() => {
        hideStatus();
    });
}

// KaydedilmiÅŸ analizi yÃ¼kle
function loadSavedAnalysis() {
    const citySelect = document.getElementById('citySelect');
    const selectedCity = citySelect.value;
    
    if (!selectedCity) return;
    
    showStatus('KaydedilmiÅŸ veriler yÃ¼kleniyor...');
    
    fetch('/api/calculate_from_saved', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            city: selectedCity
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showResults(data);
        } else {
            console.log('KaydedilmiÅŸ veri bulunamadÄ±:', data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    })
    .finally(() => {
        hideStatus();
    });
}

// Durum gÃ¶sterme
function showStatus(message) {
    const statusContainer = document.getElementById('statusContainer');
    const statusText = document.getElementById('statusText');
    
    if (statusContainer && statusText) {
        statusText.textContent = message;
        statusContainer.style.display = 'block';
    }
}

// Durum gizleme
function hideStatus() {
    const statusContainer = document.getElementById('statusContainer');
    if (statusContainer) {
        statusContainer.style.display = 'none';
    }
}

// SonuÃ§larÄ± gÃ¶sterme
function showResults(data) {
    const resultsContainer = document.getElementById('results');
    const summaryContainer = document.getElementById('summaryStats');
    
    if (!resultsContainer) return;
    
    // Ã–zet istatistikleri gÃ¶ster
    if (summaryContainer && data.summary) {
        summaryContainer.innerHTML = `
            <div class="col-md-3 text-center">
                <h4 class="text-primary">${data.summary.total_races || 0}</h4>
                <small class="text-muted">Toplam KoÅŸu</small>
            </div>
            <div class="col-md-3 text-center">
                <h4 class="text-success">${data.summary.total_horses || 0}</h4>
                <small class="text-muted">Toplam At</small>
            </div>
            <div class="col-md-3 text-center">
                <h4 class="text-warning">${data.summary.avg_score || 0}%</h4>
                <small class="text-muted">Ortalama Skor</small>
            </div>
            <div class="col-md-3 text-center">
                <h4 class="text-info">${data.city_name || ''}</h4>
                <small class="text-muted">Analiz Edilen Åehir</small>
            </div>
        `;
        summaryContainer.style.display = 'flex';
    }
    
    // KoÅŸu sonuÃ§larÄ±nÄ± gÃ¶ster
    if (data.races && data.races.length > 0) {
        let html = '<h5 class="mb-3">KoÅŸu Analizleri</h5>';
        
        data.races.forEach((race, index) => {
            html += `
                <div class="race-card card mb-3">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">${race.race_number || (index + 1)}. KoÅŸu - ${race.distance || 'Bilinmiyor'} - ${race.track_condition || 'Bilinmiyor'}</h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-sm mb-0">
                                <thead class="table-dark">
                                    <tr>
                                        <th>SÄ±ra</th>
                                        <th>At AdÄ±</th>
                                        <th>Skor</th>
                                        <th>Durum</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            if (race.horses && race.horses.length > 0) {
                race.horses.forEach((horse, horseIndex) => {
                    const statusClass = horseIndex === 0 ? 'success' : horseIndex < 3 ? 'warning' : 'secondary';
                    const statusText = horseIndex === 0 ? 'GÃ¼Ã§lÃ¼ Aday' : horseIndex < 3 ? 'Aday' : 'ZayÄ±f';
                    
                    html += `
                        <tr>
                            <td><span class="badge bg-${statusClass}">${horseIndex + 1}</span></td>
                            <td><strong>${horse.name || 'Bilinmiyor'}</strong></td>
                            <td><span class="badge bg-primary">${(horse.score || 0).toFixed(1)}</span></td>
                            <td><span class="text-${statusClass}">${statusText}</span></td>
                        </tr>
                    `;
                });
            } else {
                html += '<tr><td colspan="4" class="text-center">At bilgisi bulunamadÄ±.</td></tr>';
            }
            
            html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        });
        
        // CSV indirme butonu ekle
        if (data.csv_filename) {
            html += `
                <div class="text-center mt-3">
                    <a href="/static/downloads/${data.csv_filename}" class="btn btn-success" download>
                        <i class="fas fa-download"></i> Excel DosyasÄ±nÄ± Ä°ndir
                    </a>
                </div>
            `;
        }
        
        resultsContainer.innerHTML = html;
    } else {
        resultsContainer.innerHTML = '<div class="alert alert-warning">Bu ÅŸehir iÃ§in koÅŸu verisi bulunamadÄ±.</div>';
    }
}

// Hata gÃ¶sterme
function showError(message) {
    const resultsContainer = document.getElementById('results');
    if (resultsContainer) {
        resultsContainer.innerHTML = `<div class="alert alert-danger">${message}</div>`;
    }
}

// Analiz sayÄ±sÄ±nÄ± gÃ¼ncelle
function updateAnalysisCount() {
    const countElement = document.getElementById('analysisCount');
    if (countElement && window.dailyAnalysisCount !== undefined) {
        window.dailyAnalysisCount++;
        countElement.textContent = window.dailyAnalysisCount;
    }
}

// Counter animasyonu
function animateCounters() {
    const counters = document.querySelectorAll('.counter');
    
    counters.forEach(counter => {
        const target = parseInt(counter.getAttribute('data-target'));
        const duration = 2000;
        const step = target / (duration / 16);
        let current = 0;
        
        const timer = setInterval(() => {
            current += step;
            if (current >= target) {
                current = target;
                clearInterval(timer);
            }
            
            if (counter.textContent.includes('%')) {
                counter.textContent = Math.floor(current) + '%';
            } else if (counter.textContent.includes('+')) {
                counter.textContent = Math.floor(current) + '+';
            } else {
                counter.textContent = Math.floor(current);
            }
        }, 16);
    });
}

// Sayfa scroll animasyonu
function smoothScroll() {
    const links = document.querySelectorAll('a[href^="#"]');
    links.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth'
                });
            }
        });
    });
}
</script>
{% endblock %}